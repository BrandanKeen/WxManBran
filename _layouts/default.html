<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
    <title>{% if page.title %}{{ page.title }} | {% endif %}{{ site.title }}</title>
    {% if page.excerpt %}
    <meta name="description" content="{{ page.excerpt | strip_html | normalize_whitespace | truncate: 160 | escape }}">
    {% elsif site.description %}
    <meta name="description" content="{{ site.description | escape }}">
    {% endif %}
    <script>
      (function() {
        var root = document.documentElement;
        if (!root) { return; }
        var storageKey = 'wx-theme-preference';
        var fallbackTheme = 'light';
        if (typeof window === 'undefined') {
          root.dataset.theme = fallbackTheme;
          return;
        }
        var storedTheme = null;
        try {
          storedTheme = window.localStorage.getItem(storageKey);
        } catch (error) {
          storedTheme = null;
        }
        var prefersDark = false;
        try {
          prefersDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
        } catch (error) {
          prefersDark = false;
        }
        var theme = storedTheme || (prefersDark ? 'dark' : fallbackTheme);
        root.dataset.theme = theme;
      })();
    </script>
    {% include head.html %}
    <link rel="icon" type="image/png" href="{{ '/assets/images/Hurricane_Flags.png' | relative_url }}">
    <link rel="shortcut icon" type="image/png" href="{{ '/assets/images/Hurricane_Flags.png' | relative_url }}">
    <link rel="stylesheet" href="{{ '/assets/main.css' | relative_url }}">
    {% if site.plugins contains 'jekyll-feed' %}
    {% feed_meta %}
    {% endif %}
  </head>
  <body class="site">
    <a class="skip-link" href="#content">Skip to content</a>
    <header class="site-header">
      {% include nav.html %}
    </header>
    <main id="content" class="site-content">
      {% assign rendered_content = content %}
      {% if page.collection == 'posts' %}
        {% assign rendered_content = rendered_content
          | replace: '— Weather Man Bran', '— WxManBran'
          | replace: '&mdash; Weather Man Bran', '&mdash; WxManBran'
          | replace: '—Weather Man Bran', '— WxManBran'
          | replace: '&mdash;Weather Man Bran', '&mdash; WxManBran' %}
      {% endif %}
      {% if page.collection == 'storms' and page.storm_detail_images %}
        {% capture storm_image_pair %}
<div class="storm-page__image-pair">
  {% for image in page.storm_detail_images %}
  <figure class="storm-page__image">
    <img src="{{ image.src | relative_url }}" alt="{{ image.alt }}">
  </figure>
  {% endfor %}
</div>
{% endcapture %}
        {% assign heading_close = '</h1>' %}
        {% assign heading_close_with_images = heading_close | append: storm_image_pair %}
        {% assign rendered_content = rendered_content | replace_first: heading_close, heading_close_with_images %}
      {% endif %}
      {{ rendered_content }}
      {% if page.collection == 'posts' or page.collection == 'storms' %}
        {% include share-buttons.html %}
      {% endif %}
    </main>
    <footer class="site-footer">
      <div class="site-footer__inner">
        <p class="site-footer__verse" style="margin: 0;">
          <span style="display: block; font-size: 1.1em;"><em>&ldquo;Each will be like a refuge from the wind<br>
          And a shelter from the storm,<br>
          Like streams of water in a dry country,<br>
          Like the shade of a huge rock in an exhausted land.&rdquo;</em></span>
          <span style="display: block;">(Isaiah 32:2)</span>
        </p>
        <div class="site-footer__meta" style="display: flex; flex-direction: column; gap: 0;">
          <p style="margin: 0;">Copyright &copy; 2025 WxManBran, All Rights Reserved.</p>
          <p style="margin: 0;">Contact: <a href="mailto:connect@wxmanbran.com">connect@wxmanbran.com</a></p>
        </div>
      </div>
    </footer>
    <script>
      (function() {
        var panels = document.querySelectorAll('[data-share-panel]');
        if (!panels.length) { return; }
        panels.forEach(function(panel) {
          var copyButton = panel.querySelector('[data-share-copy]');
          if (!copyButton) { return; }
          var feedback = panel.querySelector('[data-share-feedback]');

          function showFeedback(message, isError) {
            if (!feedback) { return; }
            feedback.textContent = message;
            feedback.hidden = false;
            if (isError) {
              feedback.classList.add('share-panel__feedback--error');
            } else {
              feedback.classList.remove('share-panel__feedback--error');
            }
            window.clearTimeout(feedback._timeoutId || 0);
            feedback._timeoutId = window.setTimeout(function() {
              feedback.hidden = true;
            }, 3000);
          }

          copyButton.addEventListener('click', function() {
            var url = copyButton.getAttribute('data-share-url');
            if (!url) {
              showFeedback('Link unavailable.', true);
              return;
            }

            function fallbackCopy() {
              var textarea = document.createElement('textarea');
              textarea.value = url;
              textarea.setAttribute('readonly', '');
              textarea.style.position = 'absolute';
              textarea.style.left = '-9999px';
              document.body.appendChild(textarea);
              textarea.select();
              var successful = false;
              try {
                successful = document.execCommand('copy');
              } catch (error) {
                successful = false;
              }
              document.body.removeChild(textarea);
              return successful;
            }

            function handleSuccess() {
              showFeedback('Link copied to clipboard.', false);
            }

            function handleFailure() {
              showFeedback('Unable to copy the link. Please copy it manually.', true);
            }

            if (navigator.clipboard && typeof navigator.clipboard.writeText === 'function') {
              navigator.clipboard.writeText(url).then(handleSuccess).catch(function() {
                if (!fallbackCopy()) {
                  handleFailure();
                } else {
                  handleSuccess();
                }
              });
            } else if (!fallbackCopy()) {
              handleFailure();
            } else {
              handleSuccess();
            }
          });
        });
      })();
    </script>
    <script>
      (function(){
        var root = document.documentElement;
        var storageKey = 'wx-theme-preference';
        function setTheme(theme) {
          root.dataset.theme = theme;
          try { localStorage.setItem(storageKey, theme); } catch(e) {}
          var pressed = theme === 'dark';
          document.querySelectorAll('[data-theme-toggle]').forEach(function(btn){
            btn.setAttribute('aria-pressed', String(pressed));
            btn.setAttribute('aria-label', pressed ? 'Switch to light mode' : 'Switch to dark mode');
            var live = btn.querySelector('[data-theme-toggle-text]');
            if (live) live.textContent = pressed ? 'Switch to light mode' : 'Switch to dark mode';
          });
        }
        // Initialize buttons to match current theme
        setTheme(root.dataset.theme || 'light');
        // Click handler
        document.addEventListener('click', function(e){
          var btn = e.target.closest('[data-theme-toggle]');
          if (!btn) return;
          var next = (root.dataset.theme === 'dark') ? 'light' : 'dark';
          setTheme(next);
        });
      })();
    </script>
  </body>
</html>
