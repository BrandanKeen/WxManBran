<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>{% if page.title %}{{ page.title }} | {% endif %}{{ site.title }}</title>
    {% if page.excerpt %}
    <meta name="description" content="{{ page.excerpt | strip_html | normalize_whitespace | truncate: 160 | escape }}">
    {% elsif site.description %}
    <meta name="description" content="{{ site.description | escape }}">
    {% endif %}
    <script>
      (function() {
        var root = document.documentElement;
        if (!root) { return; }
        var storageKey = 'wx-theme-preference';
        var fallbackTheme = 'light';
        if (typeof window === 'undefined') {
          root.dataset.theme = fallbackTheme;
          return;
        }
        var storedTheme = null;
        try {
          storedTheme = window.localStorage.getItem(storageKey);
        } catch (error) {
          storedTheme = null;
        }
        var prefersDark = false;
        try {
          prefersDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
        } catch (error) {
          prefersDark = false;
        }
        var theme = storedTheme || (prefersDark ? 'dark' : fallbackTheme);
        root.dataset.theme = theme;
      })();
    </script>
    {% include head.html %}
    <link rel="icon" type="image/png" href="{{ '/assets/images/Hurricane_Flags.png' | relative_url }}">
    <link rel="shortcut icon" type="image/png" href="{{ '/assets/images/Hurricane_Flags.png' | relative_url }}">
    <link rel="stylesheet" href="{{ '/assets/main.css' | relative_url }}">
    <link rel="stylesheet" href="{{ '/assets/css/site.css' | relative_url }}">
    {% if site.plugins contains 'jekyll-feed' %}
    {% feed_meta %}
    {% endif %}
  </head>
  <body class="site">
    <a class="skip-link" href="#content">Skip to content</a>
    <header class="site-header">
      {% include nav.html %}
    </header>
    <main id="content" class="site-content">
      {% assign rendered_content = content %}
      {% if page.collection == 'posts' %}
        {% assign rendered_content = rendered_content
          | replace: '— Weather Man Bran', '— WxManBran'
          | replace: '&mdash; Weather Man Bran', '&mdash; WxManBran'
          | replace: '—Weather Man Bran', '— WxManBran'
          | replace: '&mdash;Weather Man Bran', '&mdash; WxManBran' %}
      {% endif %}
      {{ rendered_content }}
      {% if page.collection == 'posts' or page.collection == 'storms' %}
        {% include share-buttons.html %}
      {% endif %}
    </main>
    <footer class="site-footer">
      <div class="site-footer__inner">
        <p>Copyright &copy; 2025 WxManBran, All Rights Reserved.</p>
        <p>Contact: <a href="mailto:connect@wxmanbran.com">connect@wxmanbran.com</a></p>
      </div>
    </footer>
    <script>
      (function() {
        var root = document.documentElement;
        var storageKey = 'wx-theme-preference';
        if (!root || typeof window === 'undefined') { return; }

        function getStoredTheme() {
          try {
            return window.localStorage.getItem(storageKey);
          } catch (error) {
            return null;
          }
        }

        function setStoredTheme(theme) {
          try {
            window.localStorage.setItem(storageKey, theme);
          } catch (error) {
            /* no-op */
          }
        }

        function resolveTheme(theme) {
          return theme === 'dark' ? 'dark' : 'light';
        }

        var toggle = document.querySelector('[data-theme-toggle]');
        if (!toggle) { return; }
        var gear = document.querySelector('[data-theme-gear]');
        var textNode = toggle.querySelector('[data-theme-toggle-text]');
        var mediaQuery = window.matchMedia ? window.matchMedia('(prefers-color-scheme: dark)') : null;

        function applyTheme(theme, shouldPersist) {
          var normalized = resolveTheme(theme);
          root.dataset.theme = normalized;
          var isDark = normalized === 'dark';
          toggle.setAttribute('aria-pressed', isDark ? 'true' : 'false');
          toggle.setAttribute('aria-label', isDark ? 'Switch to light mode' : 'Switch to dark mode');
          toggle.setAttribute('title', isDark ? 'Switch to light mode' : 'Switch to dark mode');
          if (textNode) {
            textNode.textContent = isDark ? 'Switch to light mode' : 'Switch to dark mode';
          }
          if (shouldPersist) {
            setStoredTheme(normalized);
          }
        }

        var initialTheme = root.dataset.theme || getStoredTheme();
        if (!initialTheme && mediaQuery) {
          initialTheme = mediaQuery.matches ? 'dark' : 'light';
        }
        applyTheme(initialTheme, false);

        toggle.addEventListener('click', function() {
          var nextTheme = root.dataset.theme === 'dark' ? 'light' : 'dark';
          applyTheme(nextTheme, true);
        });

        if (gear) {
          document.addEventListener('click', function(event) {
            if (!gear.open) {
              return;
            }
            if (gear.contains(event.target)) {
              return;
            }
            gear.open = false;
          });
        }

        if (mediaQuery) {
          var mediaHandler = function(event) {
            if (getStoredTheme()) {
              return;
            }
            applyTheme(event.matches ? 'dark' : 'light', false);
          };
          if (typeof mediaQuery.addEventListener === 'function') {
            mediaQuery.addEventListener('change', mediaHandler);
          } else if (typeof mediaQuery.addListener === 'function') {
            mediaQuery.addListener(mediaHandler);
          }
        }
      })();
    </script>
    <script>
      (function() {
        var panels = document.querySelectorAll('[data-share-panel]');
        if (!panels.length) { return; }
        panels.forEach(function(panel) {
          var copyButton = panel.querySelector('[data-share-copy]');
          if (!copyButton) { return; }
          var feedback = panel.querySelector('[data-share-feedback]');

          function showFeedback(message, isError) {
            if (!feedback) { return; }
            feedback.textContent = message;
            feedback.hidden = false;
            if (isError) {
              feedback.classList.add('share-panel__feedback--error');
            } else {
              feedback.classList.remove('share-panel__feedback--error');
            }
            window.clearTimeout(feedback._timeoutId || 0);
            feedback._timeoutId = window.setTimeout(function() {
              feedback.hidden = true;
            }, 3000);
          }

          copyButton.addEventListener('click', function() {
            var url = copyButton.getAttribute('data-share-url');
            if (!url) {
              showFeedback('Link unavailable.', true);
              return;
            }

            function fallbackCopy() {
              var textarea = document.createElement('textarea');
              textarea.value = url;
              textarea.setAttribute('readonly', '');
              textarea.style.position = 'absolute';
              textarea.style.left = '-9999px';
              document.body.appendChild(textarea);
              textarea.select();
              var successful = false;
              try {
                successful = document.execCommand('copy');
              } catch (error) {
                successful = false;
              }
              document.body.removeChild(textarea);
              return successful;
            }

            function handleSuccess() {
              showFeedback('Link copied to clipboard.', false);
            }

            function handleFailure() {
              showFeedback('Unable to copy the link. Please copy it manually.', true);
            }

            if (navigator.clipboard && typeof navigator.clipboard.writeText === 'function') {
              navigator.clipboard.writeText(url).then(handleSuccess).catch(function() {
                if (!fallbackCopy()) {
                  handleFailure();
                } else {
                  handleSuccess();
                }
              });
            } else if (!fallbackCopy()) {
              handleFailure();
            } else {
              handleSuccess();
            }
          });
        });
      })();
    </script>
  </body>
</html>
